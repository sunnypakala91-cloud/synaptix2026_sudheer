<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Adaptive Assessment Test</title>
<style>
/* ===== Modern Soft Animated Background ===== */
body{margin:0;font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;height:100vh;overflow:hidden;background: #f0f4ff;display:flex;justify-content:center;align-items:center;}
body::before,body::after{content:"";position:absolute;width:600px;height:600px;border-radius:50%;filter: blur(120px);z-index:0;animation: move 12s infinite alternate ease-in-out;}
body::before{ background:#667eea; top:-200px; left:-200px; }
body::after{ background:#ff6ec4; bottom:-200px; right:-200px; }
@keyframes move{ from{ transform:translateY(0px) translateX(0px); } to{ transform:translateY(40px) translateX(40px); } }
.header{position:absolute;top:0;width:100%;background:white;color:#333;padding:18px;text-align:center;font-size:22px;font-weight:bold;box-shadow:0 2px 10px rgba(0,0,0,0.1);z-index:2;}
.box{position:relative;z-index:1;background:white;padding:30px;width:500px;border-radius:20px;box-shadow:0 20px 40px rgba(0,0,0,0.15);animation: fadeIn 0.6s ease-in-out;}
#studentInfo{text-align:center;margin-bottom:15px;font-weight:bold;color:#333;}
#timer{text-align:center;font-weight:bold;font-size:18px;margin-bottom:15px;color:#667eea;}
#qno{color:#667eea;}
.option{padding:12px;margin:10px 0;border:1px solid #ddd;border-radius:12px;cursor:pointer;transition:0.3s;}
.option:hover{ background:#eef2ff; transform:translateX(5px); }
.selected{ background:#667eea; color:white; border-color:#667eea; }
button{padding:12px 18px;margin:10px 5px;border:none;border-radius:10px;cursor:pointer;font-weight:bold;transition:0.3s;}
.submit{ background:#48bb78; color:white; }
.next{ background:#667eea; color:white; }
button:hover:not(:disabled){ transform:scale(1.05); }
button:disabled{ background:gray; cursor:not-allowed; }
#status{ margin-top:10px; font-weight:bold; }
.submitted{ color:green; }
@keyframes fadeIn{ from{opacity:0; transform:translateY(15px);} to{opacity:1; transform:translateY(0);} }
</style>
</head>

<body>

<div class="header">Adaptive Assessment Platform</div>

<div class="box">
    <div id="studentInfo"></div>
    <div id="timer">Time Left: 15s</div>
    <h3 id="qno"></h3>
    <h2 id="question"></h2>
    <div id="options"></div>
    <button class="submit" onclick="submitAnswer()" id="submitBtn">Submit</button>
    <button class="next" onclick="nextQuestion()" id="nextBtn" disabled>Next</button>
    <div id="status"></div>
</div>

<script>
// Student info
var studentName = localStorage.getItem("studentName");
var rollNumber = localStorage.getItem("rollNumber");
if(!studentName || !rollNumber){ alert("Please enter your details first!"); window.location="index.html"; }
else{ document.getElementById("studentInfo").innerText = `Name: ${studentName} | Roll No: ${rollNumber}`; }

// ===== Question Pools =====
const btech = [
    {q:"What is the main function of an Operating System?", answer:"Manage resources", explanation:"OS manages CPU, memory, and devices."},
    {q:"Define Virtual Memory.", answer:"Memory management technique", explanation:"Virtual memory allows programs to use more memory than physically available."},
    {q:"What is TCP/IP used for?", answer:"Networking protocols", explanation:"TCP/IP is the basic communication language of the internet."},
    {q:"Which data structure uses FIFO?", answer:"Queue", explanation:"Queue is First-In-First-Out data structure."},
    {q:"CPU stands for?", answer:"Central Processing Unit", explanation:"CPU is the brain of the computer which executes instructions."}
];

const programming = [
    {q:"HTML stands for?", answer:"HyperText Markup Language", explanation:"HTML is used to create webpages."},
    {q:"CSS is used for?", answer:"Styling webpages", explanation:"CSS controls the layout and appearance of HTML elements."},
    {q:"Which language is used for backend development?", answer:"Python", explanation:"Python is commonly used for backend and server-side development."},
    {q:"JavaScript is primarily?", answer:"Client-side scripting language", explanation:"JS is used to make web pages interactive."},
    {q:"Which loop is best for known iteration count?", answer:"For loop", explanation:"For loop is used when number of iterations is known."}
];

const generalKnowledge = [
    {q:"Capital of France?", answer:"Paris", explanation:"Paris is the capital city of France."},
    {q:"Who wrote 'Hamlet'?", answer:"William Shakespeare", explanation:"Shakespeare wrote Hamlet in the 1600s."},
    {q:"Fastest land animal?", answer:"Cheetah", explanation:"Cheetah can reach speeds up to 70 mph."},
    {q:"H2O is?", answer:"Water", explanation:"H2O is the chemical formula of water."},
    {q:"Which planet is known as Red Planet?", answer:"Mars", explanation:"Mars is called the Red Planet due to its reddish color."}
];

// ===== Helpers =====
function shuffleArray(arr){ return arr.sort(()=>0.5 - Math.random()); }
function generateUniqueQuestions(count=10){
    const allQuestions = [...btech, ...programming, ...generalKnowledge];
    const shuffled = shuffleArray(allQuestions);
    return shuffled.slice(0,count).map(q=>{
        let wrongs = shuffleArray(allQuestions.filter(item=>item.answer!==q.answer).map(i=>i.answer)).slice(0,3);
        return { q:q.q, answer:q.answer, explanation:q.explanation, options:shuffleArray([q.answer,...wrongs]) };
    });
}

// ===== Persistent State =====
let state = JSON.parse(localStorage.getItem("quizState")) || {
    questions: generateUniqueQuestions(10),
    index: 0,
    answers: [],
    timeLeft: 15
};

// Save state
function saveState(){ localStorage.setItem("quizState", JSON.stringify(state)); }

// Load question
function loadQuestion(){
    const q = state.questions[state.index];
    document.getElementById("qno").innerText = `Question ${state.index+1} of ${state.questions.length}`;
    document.getElementById("question").innerText = `${state.index+1}. ${q.q}`;
    document.getElementById("options").innerHTML = q.options.map(opt=>{
        return `<div class='option' onclick='selectOption(this)'>${opt}</div>`;
    }).join('');

    // Restore previous selection if exists
    const prev = state.answers[state.index];
    if(prev){
        Array.from(document.getElementsByClassName("option")).forEach(o=>{
            if(o.innerText===prev.selected) o.classList.add("selected");
        });
        selected = prev.selected;
        submitted = true;
        document.getElementById("submitBtn").disabled = true;
        document.getElementById("nextBtn").disabled = false;
        document.getElementById("status").innerText = "Submitted ✓";
        document.getElementById("status").className = "submitted";
    } else {
        selected = "";
        submitted = false;
        document.getElementById("submitBtn").disabled = false;
        document.getElementById("nextBtn").disabled = true;
        document.getElementById("status").innerText = "";
    }

    startTimer();
}

// Timer
let timer;
function startTimer(){
    clearInterval(timer);
    document.getElementById("timer").innerText = `Time Left: ${state.timeLeft}s`;
    timer = setInterval(()=>{
        state.timeLeft--;
        if(state.timeLeft<0){
            clearInterval(timer);
            nextQuestion(true);
        } else {
            document.getElementById("timer").innerText = `Time Left: ${state.timeLeft}s`;
        }
        saveState();
    },1000);
}

// Option select
var selected="", submitted=false;
function selectOption(el){
    if(submitted) return;
    Array.from(document.getElementsByClassName("option")).forEach(o=>o.classList.remove("selected"));
    el.classList.add("selected");
    selected = el.innerText;
}

// Submit answer
function submitAnswer(){
    if(selected===""){ alert("Please select an option"); return; }
    clearInterval(timer);
    submitted=true;
    const q = state.questions[state.index];
    state.answers[state.index] = { question:q.q, selected:selected, correct:q.answer, explanation:q.explanation };
    state.indexScore = (state.indexScore||0) + (selected===q.answer?1:0);
    document.getElementById("status").innerText = "Submitted ✓";
    document.getElementById("status").className = "submitted";
    document.getElementById("submitBtn").disabled = true;
    document.getElementById("nextBtn").disabled = false;
    saveState();
}

// Next question
function nextQuestion(timeUp=false){
    const q = state.questions[state.index];
    if(timeUp){
        state.answers[state.index] = { question:q.q, selected:"No Answer", correct:q.answer, explanation:q.explanation };
    }
    state.index++;
    state.timeLeft = 15;
    if(state.index >= state.questions.length){
        localStorage.setItem("score", state.answers.filter(a=>a.selected===a.correct).length);
        localStorage.setItem("answers", JSON.stringify(state.answers));
        localStorage.removeItem("quizState");
        window.location="result.html";
    } else { loadQuestion(); saveState(); }
}

// Initialize
loadQuestion();
</script>

</body>
</html>